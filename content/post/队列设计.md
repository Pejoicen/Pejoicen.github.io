---
title: "队列实现"
date: 2019-09-17T21:46:43+08:00
description: ""
draft: false
tags: ["MFC","队列"]
categories: ["软件"]
---

队列实现方式
<!--more-->

```cpp
#define MAX_DEPTH 10

#自定义数据结构
typedef struct _DisplayInfo
{
	char strInfoBuf[1024];
	int strLen;
} DisplayInfo;

DisplayInfo BufTeam[MAX_DEPTH];
DisplayInfo * BufTeamIn,BufTeamOut;

// 加锁
CCriticalSection g_InsertInfoCriticalSection;
CCriticalSection g_OutputInfoCriticalSection;

//----------------------------------
//队列操作

//多处改变同一个变量就需要加锁！


// 判断队列是否满
int isTeamFull(Param)
{
    int nItems = 0;
    if((BufTeamOut >= BufTeam )
        nItems = BufTeamOut - BufTeamIn;
    else
        nItems = MAX_DEPTH - BufTeamOut + BufTeamIn;  
    
    return (nItems >= (MAX_DEPTH - 1));
}

//插入队列
void InsertTeam(Param)
{
    g_InsertInfoCriticalSection.Lock();

    // 判断队列是否满  // 如果队列满，则丢弃队列中的数据
    if(isTeamFull())        
    {
        if((BufTeamOut - BufTeam +1)== MAX_DEPTH)   // 保证In和Out不会一致
            BufTeamOut = BufTeam;
        else
            BufTeamOut ++;  
    }
    
    // 写入队列
    memcpy(BufTeamIn,Param,sizeof(Param));
    
    // 写入后，进队列指针移动
    if((BufTeamIn - BufTeam +1)== MAX_DEPTH)
        BufTeamIn = BufTeam;
    else
        BufTeamIn ++;  
        
    g_InsertInfoCriticalSection.Unlock();
}

// 出队列
void PickOutTeam(Param)
{
    g_OutputInfoCriticalSection.Lock();

    // 相应的数据处理

    if(BufTeamOut != BufTeamIn)
    {
        // 处理后，进队列指针移动
        if((BufTeamOut - BufTeam +1)== MAX_DEPTH)
            BufTeamIn = BufTeam;
        else
            BufTeamOut ++;  
    }
    
    g_OutputInfoCriticalSection.Unlock();
}

```


